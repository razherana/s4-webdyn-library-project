<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>User Sidebar Fragment</title>
  </head>
  <body>
    <!-- User Sidebar Fragment -->
    <nav th:fragment="sidebar(activeMenu)" class="sidebar d-flex flex-column">
      <a class="navbar-brand d-flex align-items-center" href="/user/home">
        <span class="me-2">
          <i class="fas fa-book-reader"></i>
        </span>
        Library Portal
      </a>

      <div class="accordion accordion-flush" id="sidebarAccordion">
        <!-- Dashboard Group -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#dashboardCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu == 'dashboard' ? 'active-parent' : ''}"
            >
              <i class="fas fa-tachometer-alt me-2"></i> Dashboard
            </button>
          </h2>
          <div
            id="dashboardCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu == 'dashboard' ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li class="nav-item nav-subitem">
                  <a
                    class="nav-link"
                    href="/user/home"
                    th:classappend="${activeMenu == 'home' ? 'active' : ''}"
                  >
                    <i class="fas fa-home me-2"></i> Home
                  </a>
                </li>
                <li class="nav-item nav-subitem">
                  <a
                    class="nav-link"
                    href="/user/profile"
                    th:classappend="${activeMenu == 'profile' ? 'active' : ''}"
                  >
                    <i class="fas fa-user me-2"></i> My Profile
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Books Group -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#booksCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu == 'books' ? 'active-parent' : ''}"
            >
              <i class="fas fa-book me-2"></i> Books
            </button>
          </h2>
          <div
            id="booksCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu == 'books' ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li class="nav-item nav-subitem">
                  <a
                    class="nav-link"
                    href="/user/books"
                    th:classappend="${activeMenu == 'book-catalog' ? 'active' : ''}"
                  >
                    <i class="fas fa-list me-2"></i> Book Catalog
                  </a>
                </li>
                <li class="nav-item nav-subitem">
                  <a
                    class="nav-link"
                    href="/user/books/search"
                    th:classappend="${activeMenu == 'book-search' ? 'active' : ''}"
                  >
                    <i class="fas fa-search me-2"></i> Search Books
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Loans & Reservations Group -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#loansCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu == 'loans-reservations' ? 'active-parent' : ''}"
            >
              <i class="fas fa-bookmark me-2"></i> My Borrowings
            </button>
          </h2>
          <div
            id="loansCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu == 'loans-reservations' ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li class="nav-item nav-subitem">
                  <a
                    class="nav-link"
                    href="/user/loans"
                    th:classappend="${activeMenu == 'loans' ? 'active' : ''}"
                  >
                    <i class="fas fa-book-open me-2"></i> My Loans
                  </a>
                </li>
                <li class="nav-item nav-subitem">
                  <a
                    class="nav-link"
                    href="/user/reservations"
                    th:classappend="${activeMenu == 'reservations' ? 'active' : ''}"
                  >
                    <i class="fas fa-calendar-check me-2"></i> My Reservations
                  </a>
                </li>
                <li class="nav-item nav-subitem">
                  <a
                    class="nav-link"
                    href="/user/history"
                    th:classappend="${activeMenu == 'history' ? 'active' : ''}"
                  >
                    <i class="fas fa-history me-2"></i> Borrowing History
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="logout-container mt-auto">
        <a
          href="#"
          onclick="document.getElementById('logout-form').submit(); return false;"
          class="nav-link text-danger"
        >
          <span class="me-2">
            <i class="fas fa-sign-out-alt"></i>
          </span>
          Logout
        </a>
        <form
          id="logout-form"
          action="/auth/logout"
          method="post"
          style="display: none"
        ></form>
      </div>
    </nav>

    <!-- Include the same CSS styles as main sidebar -->
    <div th:fragment="sidebar-styles">
      <style>
        /* Additional styles for accordion sidebar */
        .accordion-button {
          padding: 0.8rem 1.25rem;
          color: rgba(255, 255, 255, 0.8);
          background-color: transparent;
          box-shadow: none;
        }

        .accordion-button:not(.collapsed) {
          color: white;
          background-color: rgba(255, 255, 255, 0.1);
          box-shadow: none;
        }

        .accordion-button::after {
          filter: invert(1);
          opacity: 0.5;
        }

        .accordion-button:not(.collapsed)::after {
          filter: invert(1);
          opacity: 0.8;
        }

        .sidebar .accordion {
          --bs-accordion-bg: transparent;
          --bs-accordion-border-color: transparent;
          --bs-accordion-btn-focus-box-shadow: none;
          --bs-accordion-active-bg: transparent;
          --bs-accordion-active-color: white;
        }

        .sidebar .accordion-item {
          background-color: transparent;
          border: none;
        }

        .sidebar .accordion-body {
          padding: 0;
        }

        .sidebar .nav-subitem .nav-link {
          padding-left: 3.5rem;
        }

        .sidebar .nav-link.active-parent {
          background-color: rgba(0, 123, 255, 0.3);
          color: white;
        }

        .sidebar .nav-link.active {
          background-color: rgba(0, 123, 255, 0.2);
          color: white;
          font-weight: 500;
        }
      </style>
    </div>

    <!-- JS for sidebar toggle on mobile -->
    <script th:fragment="sidebar-scripts">
      // Toggle sidebar on mobile
      document
        .querySelector(".toggle-btn")
        ?.addEventListener("click", function () {
          document.querySelector(".sidebar").classList.toggle("active");
          document.querySelector(".main-content").classList.toggle("active");
        });
    </script>
  </body>
</html>
