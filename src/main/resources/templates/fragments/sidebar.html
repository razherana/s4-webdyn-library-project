<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Sidebar Fragment</title>
  </head>
  <body>
    <!-- Sidebar Fragment -->
    <nav th:fragment="sidebar(activeMenu)" class="sidebar d-flex flex-column">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <span class="me-2">
          <i class="fas fa-book-reader"></i>
        </span>
        Library Management
      </a>

      <!-- No need for inline function since we're using AccessEvaluatorService -->

      <div class="accordion accordion-flush" id="sidebarAccordion">
        <!-- Dashboard Group - Always visible -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#dashboardCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu == 'dashboard' ? 'active-parent' : ''}"
            >
              <i class="fas fa-tachometer-alt me-2"></i> Dashboard
            </button>
          </h2>
          <div
            id="dashboardCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu == 'dashboard' ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/home')}"
                >
                  <a
                    class="nav-link"
                    href="/home"
                    th:classappend="${activeMenu == 'home' ? 'active' : ''}"
                  >
                    <i class="fas fa-home me-2"></i> Home
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${isAdmin == true}"
                >
                  <a
                    class="nav-link"
                    href="#"
                    th:classappend="${activeMenu == 'about' ? 'active' : ''}"
                  >
                    <i class="fas fa-info-circle me-2"></i> About
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Books Group -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#booksCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu == 'books' ? 'active-parent' : ''}"
            >
              <i class="fas fa-book me-2"></i> Books
            </button>
          </h2>
          <div
            id="booksCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu == 'books' ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/books')}"
                >
                  <a
                    class="nav-link"
                    href="/books"
                    th:classappend="${activeMenu == 'book-collection' ? 'active' : ''}"
                  >
                    <i class="fas fa-list me-2"></i> Book Collection
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Memberships Group -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#membershipsCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu == 'memberships' ? 'active-parent' : ''}"
            >
              <i class="fas fa-id-card me-2"></i> Memberships
            </button>
          </h2>
          <div
            id="membershipsCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu == 'memberships' ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/peoples')}"
                >
                  <a
                    class="nav-link"
                    href="/peoples"
                    th:classappend="${activeMenu == 'peoples' ? 'active' : ''}"
                  >
                    <i class="fas fa-users me-2"></i> People
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/people-api')}"
                >
                  <a
                    class="nav-link"
                    href="/people-api"
                    th:classappend="${activeMenu == 'people-api' ? 'active' : ''}"
                  >
                    <i class="fas fa-users me-2"></i> People API
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/membership-types')}"
                >
                  <a
                    class="nav-link"
                    href="/membership-types"
                    th:classappend="${activeMenu == 'membership-types' ? 'active' : ''}"
                  >
                    <i class="fas fa-tags me-2"></i> Membership Types
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/memberships')}"
                >
                  <a
                    class="nav-link"
                    href="/memberships"
                    th:classappend="${activeMenu == 'membership-list' ? 'active' : ''}"
                  >
                    <i class="fas fa-address-card me-2"></i> Memberships
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Loans & Reservations Group -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#loansCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu == 'loans-reservations' ? 'active-parent' : ''}"
            >
              <i class="fas fa-bookmark me-2"></i> Loans & Reservations
            </button>
          </h2>
          <div
            id="loansCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu == 'loans-reservations' ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/reservations')}"
                >
                  <a
                    class="nav-link"
                    href="/reservations"
                    th:classappend="${activeMenu == 'reservations' ? 'active' : ''}"
                  >
                    <i class="fas fa-calendar-check me-2"></i> Reservations
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/loans')}"
                >
                  <a
                    class="nav-link"
                    href="/loans"
                    th:classappend="${activeMenu == 'loans' ? 'active' : ''}"
                  >
                    <i class="fas fa-book-open me-2"></i> Loans
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/admin/extend-loans')}"
                >
                  <a
                    class="nav-link"
                    href="/admin/extend-loans"
                    th:classappend="${activeMenu == 'extend-loans' ? 'active' : ''}"
                  >
                    <i class="fas fa-clock me-2"></i> Loan Extensions
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Admin Group -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#adminCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu.startsWith('admin-') ? 'active-parent' : ''}"
            >
              <i class="fas fa-user-shield me-2"></i> Administration
            </button>
          </h2>
          <div
            id="adminCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu.startsWith('admin-') ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/admin/users')}"
                >
                  <a
                    class="nav-link"
                    href="/admin/users"
                    th:classappend="${activeMenu == 'admin-users' ? 'active' : ''}"
                  >
                    <i class="fas fa-users-cog me-2"></i> User Management
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/admin/roles')}"
                >
                  <a
                    class="nav-link"
                    href="/admin/roles"
                    th:classappend="${activeMenu == 'admin-roles' ? 'active' : ''}"
                  >
                    <i class="fas fa-user-tag me-2"></i> Role Management
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/admin/access')}"
                >
                  <a
                    class="nav-link"
                    href="/admin/access"
                    th:classappend="${activeMenu == 'admin-access' ? 'active' : ''}"
                  >
                    <i class="fas fa-shield-alt me-2"></i> Access Management
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Settings Group -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#settingsCollapse"
              aria-expanded="false"
              th:classappend="${activeMenu == 'settings' ? 'active-parent' : ''}"
            >
              <i class="fas fa-cog me-2"></i> Settings
            </button>
          </h2>
          <div
            id="settingsCollapse"
            class="accordion-collapse collapse"
            th:classappend="${activeMenu == 'settings' ? 'show' : ''}"
            data-bs-parent="#sidebarAccordion"
          >
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/reservation-status-types')}"
                >
                  <a
                    class="nav-link"
                    href="/reservation-status-types"
                    th:classappend="${activeMenu == 'reservation-status-types' ? 'active' : ''}"
                  >
                    <i class="fas fa-tags me-2"></i> Reservation Status
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/loan-status-types')}"
                >
                  <a
                    class="nav-link"
                    href="/loan-status-types"
                    th:classappend="${activeMenu == 'loan-status-types' ? 'active' : ''}"
                  >
                    <i class="fas fa-tag me-2"></i> Loan Status
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/feries')}"
                >
                  <a
                    class="nav-link"
                    href="/feries"
                    th:classappend="${activeMenu == 'feries' ? 'active' : ''}"
                  >
                    <i class="fas fa-tag me-2"></i> Jours Fériés
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/returned-loan-state-types')}"
                >
                  <a
                    class="nav-link"
                    href="/returned-loan-state-types"
                    th:classappend="${activeMenu == 'returned-loan-state-types' ? 'active' : ''}"
                  >
                    <i class="fas fa-clipboard-check me-2"></i> Return States
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/loan-types')}"
                >
                  <a
                    class="nav-link"
                    href="/loan-types"
                    th:classappend="${activeMenu == 'loan-types' ? 'active' : ''}"
                  >
                    <i class="fas fa-layer-group me-2"></i> Loan Types
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/punishment-types')}"
                >
                  <a
                    class="nav-link"
                    href="/punishment-types"
                    th:classappend="${activeMenu == 'punishment-types' ? 'active' : ''}"
                  >
                    <i class="fas fa-exclamation-triangle me-2"></i> Punishment
                    Types
                  </a>
                </li>
                <li
                  class="nav-item nav-subitem"
                  th:if="${@accessEvaluatorService.hasAccess(isAdmin, userAccessUris, '/punishments')}"
                >
                  <a
                    class="nav-link"
                    href="/punishments"
                    th:classappend="${activeMenu == 'punishments' ? 'active' : ''}"
                  >
                    <i class="fas fa-gavel me-2"></i> Punishments
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="logout-container mt-auto">
        <a
          href="#"
          onclick="document.getElementById('logout-form').submit(); return false;"
          class="nav-link text-danger"
        >
          <span class="me-2">
            <i class="fas fa-sign-out-alt"></i>
          </span>
          Logout
        </a>
        <form
          id="logout-form"
          action="/auth/logout"
          method="post"
          style="display: none"
        ></form>
      </div>
    </nav>

    <!-- Include the required CSS styles for the sidebar -->
    <div th:fragment="sidebar-styles">
      <style>
        /* Additional styles for accordion sidebar */
        .accordion-button {
          padding: 0.8rem 1.25rem;
          color: rgba(255, 255, 255, 0.8);
          background-color: transparent;
          box-shadow: none;
        }

        .accordion-button:not(.collapsed) {
          color: white;
          background-color: rgba(255, 255, 255, 0.1);
          box-shadow: none;
        }

        .accordion-button::after {
          filter: invert(1);
          opacity: 0.5;
        }

        .accordion-button:not(.collapsed)::after {
          filter: invert(1);
          opacity: 0.8;
        }

        .sidebar .accordion {
          --bs-accordion-bg: transparent;
          --bs-accordion-border-color: transparent;
          --bs-accordion-btn-focus-box-shadow: none;
          --bs-accordion-active-bg: transparent;
          --bs-accordion-active-color: white;
        }

        .sidebar .accordion-item {
          background-color: transparent;
          border: none;
        }

        .sidebar .accordion-body {
          padding: 0;
        }

        .sidebar .nav-subitem .nav-link {
          padding-left: 3.5rem;
        }

        .sidebar .nav-link.active-parent {
          background-color: rgba(0, 123, 255, 0.3);
          color: white;
        }

        .sidebar .nav-link.active {
          background-color: rgba(0, 123, 255, 0.2);
          color: white;
          font-weight: 500;
        }
      </style>
    </div>

    <!-- JS for sidebar toggle on mobile -->
    <script th:fragment="sidebar-scripts">
      // Toggle sidebar on mobile
      document
        .querySelector(".toggle-btn")
        ?.addEventListener("click", function () {
          document.querySelector(".sidebar").classList.toggle("active");
          document.querySelector(".main-content").classList.toggle("active");
        });
    </script>
  </body>
</html>
